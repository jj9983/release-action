name: Autobuild
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:   
      - run: echo "Create release for branch:${{ gitea.ref_name }} ref:${{ gitea.ref }} repo:${{ gitea.repository }}."
       
      # - run: |
          # echo "nameserver 1.1.1.1" >> /etc/resolv.conf
          
      # - run: |
          # cat /etc/resolv.conf
      
      - name: Check out repository code
        uses: actions/checkout@v3
        #token: ${{ secrets.TOKEN }}
        #ref: ${{ gitea.ref_name }}
        
      - name: Create build.zip
        uses: https://github.com/vimtor/action-zip@v1
        with:
          files: build/ 
          recursive: false
          dest: build.zip
          
      - name: setup go
        uses: https://github.com/actions/setup-go@v4
        with:
          go-version: '>=1.20.1'
      
      env:
        gitea:
          ref_name: master
      
      - name: Use Go Action  
        id: use-go-action
        uses: actions/release-action@main
        with:
          files: |-
            build.zip
          api_key: '${{secrets.RELEASE_TOKEN}}'
      